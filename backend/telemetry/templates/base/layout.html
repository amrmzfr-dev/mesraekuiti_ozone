<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Ozone Machine Management{% endblock %}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap');
    
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;background:#f8fafc;font-feature-settings:'liga' 1, 'calt' 1;min-height:100vh;display:flex;flex-direction:column;transition:padding-left 0.3s ease}
    
    /* Mobile-first responsive layout */
    @media (max-width: 768px) {
      body{padding-top:60px;padding-left:0;padding-right:0}
      .main-content{padding:1rem 0.5rem}
    }
    
    @media (min-width: 769px) {
      body{padding-top:60px;padding-left:280px}
      .main-content{padding:2rem 1rem}
    }
    
    /* Sticky Topbar */
    .topbar{position:fixed;top:0;left:0;right:0;height:60px;background:white;border-bottom:1px solid #e5e7eb;z-index:1000;display:flex;align-items:center;padding:0 1rem;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    .topbar-title{font-size:1.25rem;font-weight:600;color:#1e40af;margin-right:auto;letter-spacing:-0.025em}
    .topbar-user{color:#64748b;font-size:0.75rem;font-weight:400;display:none}
    
    @media (min-width: 768px) {
      .topbar{padding:0 2rem}
      .topbar-title{font-size:1.5rem}
      .topbar-user{font-size:0.875rem;display:block}
    }
    
    /* Mobile Menu Button */
    .mobile-menu-btn{display:block;background:none;border:none;font-size:1.5rem;color:#64748b;cursor:pointer;padding:0.5rem}
    
    @media (min-width: 769px) {
      .mobile-menu-btn{display:none}
    }
    
    /* Floating Sidebar */
    .sidebar{position:fixed;top:60px;left:0;width:280px;height:calc(100vh - 60px);background:white;border-right:1px solid #e5e7eb;z-index:999;overflow-y:auto;transition:transform 0.3s ease;box-shadow:2px 0 4px rgba(0,0,0,0.1)}
    .sidebar.collapsed{transform:translateX(-280px)}
    .sidebar-header{padding:1rem;border-bottom:1px solid #e5e7eb;background:#f8fafc}
    .sidebar-title{font-size:1rem;font-weight:600;color:#1e40af;margin-bottom:0.25rem;letter-spacing:-0.025em}
    .sidebar-subtitle{color:#64748b;font-size:0.75rem;font-weight:400}
    .sidebar-nav{padding:0.5rem 0}
    .sidebar-nav a{display:block;padding:0.5rem 1rem;color:#374151;text-decoration:none;transition:all 0.2s ease;border-left:3px solid transparent;font-weight:400;font-size:0.875rem}
    .sidebar-nav a:hover{background:#f1f5f9;color:#1e40af}
    .sidebar-nav a.active{background:#eff6ff;color:#1e40af;border-left-color:#3b82f6;font-weight:500}
    .sidebar-nav a i{margin-right:0.5rem;width:16px;text-align:center}
    
    @media (min-width: 769px) {
      .sidebar-header{padding:1.5rem}
      .sidebar-title{font-size:1.25rem;margin-bottom:0.5rem}
      .sidebar-subtitle{font-size:0.875rem}
      .sidebar-nav{padding:1rem 0}
      .sidebar-nav a{padding:0.75rem 1.5rem;font-size:0.875rem}
      .sidebar-nav a i{margin-right:0.75rem;width:20px}
    }
    
    /* Sidebar Toggle */
    .sidebar-toggle{position:fixed;top:70px;left:280px;width:40px;height:40px;background:white;border:1px solid #e5e7eb;border-radius:0 8px 8px 0;cursor:pointer;z-index:1001;display:flex;align-items:center;justify-content:center;transition:left 0.3s ease;box-shadow:2px 0 4px rgba(0,0,0,0.1)}
    .sidebar-toggle:hover{background:#f8fafc}
    .sidebar.collapsed + .sidebar-toggle{left:0}
    .sidebar-toggle::before{content:'☰';font-size:1.2rem;color:#64748b}
    .sidebar.collapsed + .sidebar-toggle::before{content:'☰'}
    
    @media (max-width: 768px) {
      .sidebar-toggle{display:none}
    }
    
    /* Main Content */
    .main-content{max-width:1450px;margin:0 auto;flex:1;width:100%}
    .card{background:white;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.1);padding:1rem;width:100%}
    
    @media (min-width: 768px) {
      .card{padding:1.5rem}
    }
    
    /* Common Styles */
    .btn{padding:0.375rem 0.75rem;border:none;border-radius:6px;cursor:pointer;text-decoration:none;font-size:0.75rem;margin-right:0.25rem;display:inline-block;font-weight:500;letter-spacing:0.025em;white-space:nowrap}
    .btn-primary{background:#3b82f6;color:white}
    .btn-secondary{background:#6b7280;color:white}
    .btn-danger{background:#dc2626;color:white}
    .btn-info{background:#0ea5e9;color:white}
    .btn:hover{opacity:0.9}
    
    @media (min-width: 768px) {
      .btn{padding:0.5rem 1rem;font-size:0.875rem;margin-right:0.5rem;border-radius:8px}
    }
    
    /* Breadcrumb */
    .breadcrumb{margin-bottom:1rem;color:#64748b}
    .breadcrumb a{color:#3b82f6;text-decoration:none}
    
    /* Form Styles */
    .form-group{margin-bottom:1rem}
    .form-group label{display:block;margin-bottom:0.25rem;font-weight:500;letter-spacing:0.025em}
    .form-group input,.form-group select,.form-group textarea{width:100%;padding:0.5rem;border:1px solid #d1d5db;border-radius:8px;box-sizing:border-box;font-family:inherit;font-size:0.875rem}
    .form-actions{display:flex;gap:0.5rem;margin-top:1rem}
    
    /* Table Styles */
    .table-container{width:100%;margin:1rem 0;background:white;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border:1px solid #e5e7eb;overflow:hidden}
    .table{width:100%;border-collapse:collapse;font-size:0.75rem;background:white;table-layout:auto;margin:0;transition:opacity 0.1s ease}
    .table th,.table td{padding:0.5rem;text-align:center;border-bottom:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word}
    .stat-card{padding:0.75rem 0.5rem;border-radius:8px;background:white;border:1px solid #e5e7eb;box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.25rem}
    .stat-card.stat-accent{background:#eef2ff;border-color:#c7d2fe}
    .stat-number{font-size:1.5rem;line-height:1.1;font-weight:700;color:#1e3a8a}
    .stat-label{color:#475569;font-size:0.75rem;letter-spacing:0.02em}
    .stat-sub{margin-top:0.25rem}
    .text-danger{color:#dc2626;font-weight:600}
    
    /* Vertical separators for specific columns (outlets table) */
    .col-premium{border-right:1px solid #e5e7eb}
    .col-sep{border-right:1px solid #e5e7eb}
    .table th{background:#f8fafc;font-weight:600;color:#374151;letter-spacing:0.025em;position:sticky;top:0;z-index:10}
    .table tr:hover{background:#f8fafc}
    
    /* Mobile table responsive */
    @media (max-width: 768px) {
      .table{font-size:0.7rem}
      .table th,.table td{padding:0.375rem 0.25rem}
      .stat-card{padding:0.5rem 0.25rem}
      .stat-number{font-size:1.25rem}
      .stat-label{font-size:0.7rem}
    }
    
    @media (min-width: 768px) {
      .table{font-size:0.875rem}
      .table th,.table td{padding:1rem}
      .stat-card{padding:1.25rem 1rem}
      .stat-number{font-size:2.25rem}
      .stat-label{font-size:0.9rem}
    }
    
    /* Fixed height table with scroll */
    .table-scrollable{height:calc(70vh - 100px);min-height:300px;max-height:600px;overflow-y:auto;overflow-x:auto}
    .table-scrollable-outlets{height:calc(70vh - 100px);min-height:300px;max-height:600px;overflow-y:auto;overflow-x:auto}
    .table-scrollable-devices{height:calc(70vh - 100px);min-height:300px;max-height:600px;overflow-y:auto;overflow-x:auto}
    .table-scrollable::-webkit-scrollbar,.table-scrollable-outlets::-webkit-scrollbar,.table-scrollable-devices::-webkit-scrollbar{width:6px;height:6px}
    .table-scrollable::-webkit-scrollbar-track,.table-scrollable-outlets::-webkit-scrollbar-track,.table-scrollable-devices::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px}
    .table-scrollable::-webkit-scrollbar-thumb,.table-scrollable-outlets::-webkit-scrollbar-thumb,.table-scrollable-devices::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}
    .table-scrollable::-webkit-scrollbar-thumb:hover,.table-scrollable-outlets::-webkit-scrollbar-thumb:hover,.table-scrollable-devices::-webkit-scrollbar-thumb:hover{background:#94a3b8}
    
    @media (min-width: 768px) {
      .table-scrollable{height:calc(78vh - 100px);min-height:350px;max-height:700px}
      .table-scrollable-outlets{height:calc(78vh - 100px);min-height:350px;max-height:700px}
      .table-scrollable-devices{height:calc(78vh - 100px);min-height:350px;max-height:700px}
      .table-scrollable::-webkit-scrollbar,.table-scrollable-outlets::-webkit-scrollbar,.table-scrollable-devices::-webkit-scrollbar{width:8px;height:8px}
    }
    
    /* Status Badges */
    .status-badge{padding:0.125rem 0.375rem;border-radius:6px;font-size:0.65rem;font-weight:500;letter-spacing:0.025em;white-space:nowrap}
    .status-online{background:#dcfce7;color:#166534}
    .status-idle{background:#fef3c7;color:#92400e}
    .status-offline{background:#fee2e2;color:#991b1b}
    .status-loading{background:#f1f5f9;color:#64748b}
    .status-assigned{background:#dbeafe;color:#1e40af}
    .status-unassigned{background:#f3f4f6;color:#6b7280}
    
    @media (min-width: 768px) {
      .status-badge{padding:0.25rem 0.5rem;font-size:0.75rem;border-radius:8px}
    }
    
    /* Stats Grid */
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.75rem;margin:1rem 0;width:100%}
    .stat-card{padding:0.75rem;background:white;border-radius:8px;border-left:4px solid #3b82f6;border:1px solid #e5e7eb;box-shadow:0 1px 3px rgba(0,0,0,0.1);width:100%}
    .stat-number{font-size:1.5rem;font-weight:700;color:#1e40af;letter-spacing:-0.05em}
    .stat-label{color:#64748b;font-size:0.75rem;font-weight:400;letter-spacing:0.025em}
    
    @media (min-width: 768px) {
      .stats{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin:1.5rem 0}
      .stat-card{padding:1rem}
      .stat-number{font-size:2rem}
      .stat-label{font-size:0.875rem}
    }
    
    /* Error/Success Messages */
    .alert{padding:1rem;border-radius:8px;margin:1rem 0}
    .alert-error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
    .alert-success{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}
    
    /* Typography Enhancements for JetBrains Mono */
    h1,h2,h3,h4,h5,h6{font-weight:600;letter-spacing:-0.025em;color:#1e40af}
    h1{font-size:1.5rem;margin-bottom:0.75rem}
    h2{font-size:1.25rem;margin-bottom:0.5rem}
    h3{font-size:1.125rem;margin-bottom:0.5rem}
    p{line-height:1.6;margin-bottom:1rem;font-weight:400}
    code{font-family:'JetBrains Mono', monospace;background:#f1f5f9;padding:0.125rem 0.25rem;border-radius:8px;font-size:0.875em}
    pre{font-family:'JetBrains Mono', monospace;background:#f8fafc;padding:1rem;border-radius:8px;overflow-x:auto;font-size:0.875rem}
    
    @media (min-width: 768px) {
      h1{font-size:2rem;margin-bottom:1rem}
      h2{font-size:1.5rem;margin-bottom:0.75rem}
      h3{font-size:1.25rem;margin-bottom:0.5rem}
    }
    
    
    /* Additional custom styles */
    {% block extra_css %}{% endblock %}
  </style>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  {% block extra_head %}{% endblock %}
</head>
<body>
  <!-- Sticky Topbar -->
  <div class="topbar">
    <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">☰</button>
    <div class="topbar-title">Ozone Machine Management</div>
    <div class="topbar-user">Welcome, {{ user.username }} ({{ user.get_role_display }})</div>
  </div>
  
  <!-- Floating Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">Navigation</div>
      <div class="sidebar-subtitle">System Management</div>
    </div>
    <nav class="sidebar-nav">
      <a href="/dashboard/" {% if request.resolver_match.url_name == 'dashboard' %}class="active"{% endif %}>
        <i>📊</i>Dashboard
      </a>
      <a href="/outlets/" {% if 'outlets' in request.resolver_match.url_name %}class="active"{% endif %}>
        <i>🏢</i>Outlets
      </a>
      <a href="/machines/" {% if 'machines' in request.resolver_match.url_name %}class="active"{% endif %}>
        <i>⚙️</i>Machines
      </a>
      <a href="/devices/" {% if 'devices' in request.resolver_match.url_name %}class="active"{% endif %}>
        <i>📱</i>Devices
      </a>
      
      <!-- Separator -->
      <div style="height:1px;background:#e5e7eb;margin:1rem 1.5rem;"></div>
      
      <!-- Reports Section -->
      <a href="/statistics/" {% if 'statistics' in request.resolver_match.url_name %}class="active"{% endif %}>
        <i>📈</i>Statistics
      </a>
      <a href="/reports/" {% if 'reports' in request.resolver_match.url_name %}class="active"{% endif %}>
        <i>📋</i>Generate Reports
      </a>
    </nav>
    
    <!-- Logout Section -->
    <div style="position:absolute;bottom:0;left:0;right:0;padding:1rem 0;border-top:1px solid #e5e7eb;background:white;">
      <a href="/logout/" style="display:block;padding:0.75rem 1.5rem;color:#dc2626;text-decoration:none;transition:all 0.2s ease;border-left:3px solid transparent;font-weight:500;">
        <i>🚪</i>Logout
      </a>
    </div>
  </div>
  
  <!-- Sidebar Toggle -->
  <div class="sidebar-toggle" onclick="toggleSidebar()"></div>
  
  <!-- Main Content -->
  <div class="main-content">
    {% block breadcrumb %}{% endblock %}
    
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
    
    {% block content %}{% endblock %}
  </div>
  
  
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const body = document.body;
      
      sidebar.classList.toggle('collapsed');
      
      if (sidebar.classList.contains('collapsed')) {
        body.style.paddingLeft = '0';
        localStorage.setItem('sidebarCollapsed', 'true');
      } else {
        body.style.paddingLeft = '280px';
        localStorage.setItem('sidebarCollapsed', 'false');
      }
    }
    
    function toggleMobileSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
    }
    
    // Restore sidebar state on page load
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('sidebar');
      const body = document.body;
      const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
      
      // On mobile, always start collapsed
      if (window.innerWidth <= 768) {
        sidebar.classList.add('collapsed');
        body.style.paddingLeft = '0';
      } else if (isCollapsed) {
        sidebar.classList.add('collapsed');
        body.style.paddingLeft = '0';
      }
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
      const sidebar = document.getElementById('sidebar');
      const body = document.body;
      
      if (window.innerWidth <= 768) {
        sidebar.classList.add('collapsed');
        body.style.paddingLeft = '0';
      } else {
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        if (isCollapsed) {
          sidebar.classList.add('collapsed');
          body.style.paddingLeft = '0';
        } else {
          sidebar.classList.remove('collapsed');
          body.style.paddingLeft = '280px';
        }
      }
    });
    
    {% block extra_js %}{% endblock %}
  </script>
</body>
</html>
